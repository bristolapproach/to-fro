{"version":3,"sources":["admin.js"],"names":["ATTR_EDITED","document","addEventListener","window","django","$","jQuery","data","getData","setupUserAjaxUrl","setupActionDescriptionTemplates","setupHelpTypeDefaultRequirements","setupUserAccountsBehaviour","setupConfirmNavigationIfEdited","element","getElementById","JSON","parse","innerText","action_requirements_for_help_types","on","target","defaultRequirements","value","SelectBox","move_all","options","toArray","option","selected","indexOf","parseInt","move","action_description_templates","templates","forEach","descriptionType","$field","descriptionTemplate","currentDescription","val","trim","hasAttribute","removeAttr","currentHelpType","setAttribute","submitted","one","event","preventDefault","returnValue","setUserFieldPlaceholder","prop","trigger","profile_type","profile_id","url","new_url","placeholder","getPlaceholder","select2"],"mappings":"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","file":"admin.js","sourceRoot":"..","sourcesContent":["// Attribute for marking a field as edited\nconst ATTR_EDITED = 'data-edited';\n\n(function () {\n  // Wait for everything to be loaded, especially jQuery\n  document.addEventListener('DOMContentLoaded', () => {\n    if (window.django) {\n      const $ = window.django.jQuery;\n      const data = getData(); // Read the data passed by the backend\n\n      setupUserAjaxUrl($, data);\n\n      // Wait until all Django related setup code has run\n      // so we don't respond to synthetic change events triggered\n      // during their initialization\n      $(function () {\n        setupActionDescriptionTemplates($, data);\n        setupHelpTypeDefaultRequirements($, data);\n        setupUserAccountsBehaviour($);\n        setupConfirmNavigationIfEdited($);\n      });\n    }\n  });\n})();\n\n\nfunction getData() {\n  const element = document.getElementById('js-data');\n  if (element) {\n    return JSON.parse(element.innerText);\n  }\n  return {};\n}\n\n/**\n * Manages the pre-filling of requirements according\n * to the default requirements associated to the selected help type\n * @param {jQuery} $ \n * @param {Object} data \n */\nfunction setupHelpTypeDefaultRequirements($, data) {\n  if (data.action_requirements_for_help_types) {\n  \n    $(document).on('change', '[name=\"help_type\"]', function ({ target }) {\n      const defaultRequirements = data.action_requirements_for_help_types[target.value] || [];\n     \n      // Clear the selected options, using Django's SelectBox API\n      // as there is some caching behind the scene that breaks if \n      // moving only the HTML elements\n      window.SelectBox.move_all('id_requirements_to','id_requirements_from')\n\n      // We need to grab the list of options each time, \n      // looks like elements are re-created by the move_all\n      const options = $('.field-requirements option').toArray();\n      for (option of options) {\n        // Mark options as selected as needed by the help type requirements\n        option.selected = defaultRequirements.indexOf(parseInt(option.value)) != -1\n      }\n    \n      // And move the selected options to the selected box\n      window.SelectBox.move('id_requirements_from','id_requirements_to')\n    });\n  }\n}\n\n/**\n * Manages the prefilling of action descriptions according\n * to the templates corrsponding to the selecte help type\n * @param {jQuery} $ \n * @param {Object} data - The hash of data passed to the view\n */\nfunction setupActionDescriptionTemplates($, data) {\n  if (data.action_description_templates) {\n    $(document).on('change', '[name=\"help_type\"]', function ({ target }) {\n      const templates = data.action_description_templates[target.value] || {};\n\n      // Loop through the fields that we have templates for.\n      ['public', 'private'].forEach((descriptionType) => {\n        const $field = $(`[name=\"${descriptionType}_description\"]`);\n        const descriptionTemplate = templates[`${descriptionType}_description_template`]\n        const currentDescription = ($field.val() || \"\").trim();\n\n        // If the current description is empty or is the template, we can update it.\n        if (!currentDescription || !$field[0].hasAttribute('data-edited')) {\n          $field.val(descriptionTemplate)\n          $field.removeAttr('data-edited');\n        }\n\n      })\n\n      currentHelpType = target.value;\n    })\n\n    // Track editions of descriptions to prevent replacement of edited value\n    $(document).on('input', '[name=\"public_description\"],[name=\"private_description\"]', function ({ target }) {\n      target.setAttribute('data-edited', '');\n    });\n  }\n}\n\n/**\n * Adds a confirmation before navigation if users\n * have edited anything on the page\n * @param {jQuery} $ \n */\nfunction setupConfirmNavigationIfEdited($) {\n  let submitted;\n  $(document).on('submit', function () {\n    submitted = true;\n  });\n  $(document).one('change', function () {\n    window.addEventListener('beforeunload', (event) => {\n      if (!submitted) {\n        // Cancel the event as stated by the standard.\n        event.preventDefault();\n        // Chrome requires returnValue to be set.\n        event.returnValue = '';\n        return `Looks like you've edited some data and not saved it yet. If you navigate away, you'll lose those changes. \n        \n        Are you sure you want to continue?\n        `\n      }\n    });\n  });\n}\n\n/**\n * Manages the user account fields in the volunteer and coordinator\n * forms\n * @param {jQuery} $ \n */\nfunction setupUserAccountsBehaviour($) {\n  // Controls which placeholder is shown, depending on whether an account is needed\n  // or not\n  $(document).on('change', '[name=\"user_without_account\"]', function () {\n    setUserFieldPlaceholder($);\n  });\n  setUserFieldPlaceholder($);\n\n  // Unchecks the \"user_without_account\" when picking an account in the list of users\n  $(document).on('change', '[name=\"user\"]', function ({ target }) {\n    if (target.value) {\n      $('[name=\"user_without_account\"]')\n        .prop('checked', false)\n        .trigger('change');\n\n    }\n  });\n}\n\nfunction setupUserAjaxUrl($, { profile_type, profile_id }) {\n  if (profile_type) {\n    const url = $('[name=\"user\"]').data('ajax--url');\n    if (url) {\n      let new_url = `${url}?without_profile_type=${profile_type}`\n      if (profile_id) {\n        new_url = `${new_url}&profile_id=${profile_id}`\n      }\n      $('[name=\"user\"').data('ajax--url', new_url)\n    }\n  }\n}\n\nfunction setUserFieldPlaceholder($) {\n  const placeholder = getPlaceholder($);\n  // Use jQuery's `data` rather than set the attribute\n  // as the attribute wouldn't get read\n  $('[name=\"user\"]').data('placeholder', placeholder);\n  $('[name=\"user\"]').select2({ placeholder });\n}\n\nfunction getPlaceholder($) {\n  if ($('[name=\"user_without_account\"]').prop('checked')) {\n    return 'No account required';\n  } else {\n    return 'Automatically create a new account';\n  }\n}\n"]}